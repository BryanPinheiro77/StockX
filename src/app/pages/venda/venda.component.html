<body>
  
><div class="layout-container">
  <aside class="sidebar">
    <h2 class="logo">StockX</h2>
    <nav>
      <ul>
        <li><button (click)="irParaProdutos()" class="link-estilo">Produtos</button></li>
        <li><button (click)="abrirDashboard()" class="link-estilo">Dashboard</button></li>
        <li><button (click)="irParaVendas()" class="link-estilo">Nova Venda</button></li>
        <li><button (click)="irParaConfiguracoes()" class="link-estilo">Configurações</button></li>
      </ul>
    </nav>
  </aside>

  <main class="main-content">
    <form [formGroup]="vendaForm" (ngSubmit)="finalizarVenda()">
      <div formArrayName="itens">
        <div *ngFor="let item of itens.controls; let i = index" [formGroupName]="i" class="item-bloco">
          <label>Nome do Produto:</label>
          <input type="text" formControlName="nome" placeholder="Digite ou selecione"
       (focus)="onCampoNomeFocado(i)" autocomplete="off" />


          <ul *ngIf="mostrarSugestoes(i) && (produtosFiltrados[i] | async) as sugestoes" class="autocomplete-list">
  <li *ngFor="let produto of sugestoes" (click)="selecionarProduto(produto, i)">
    {{ produto.name }} - {{ produto.code || produto.id }}
  </li>
</ul>
  <label>Código do produto:</label>
<div class="codigo-container">
  <input type="text" formControlName="codigo" placeholder="Digite ou escaneie o código" />
  <button type="button" class="scanner-btn" (click)="toggleScanner()">
    {{ mostrarScanner ? 'Fechar Scanner' : 'Abrir Scanner' }}
  </button>
</div>



          <label>Quantidade:</label>
          <input type="number" formControlName="quantidade" min="1" />

          <label>Preço (R$):</label>
          <input type="number" formControlName="preco" step="0.01" />

          <label>Categoria:</label>
          <input type="text" formControlName="categoria" />

          <button type="button" (click)="removerItem(i)" *ngIf="itens.length > 1">Remover</button>
          <hr />
        </div>
      </div>

      <button type="button" (click)="adicionarItem()">+ Adicionar item</button>

      <div class="scanner-container">
        <zxing-scanner 
          *ngIf="mostrarScanner"
          [device]="currentDevice ?? undefined"
          [formats]="allowedFormats"
          [enable]="scannerRunning"
          (camerasFound)="camerasFound($event)"
          (scanSuccess)="onCodeScanned($event)"
          (permissionResponse)="onHasPermission($event)"
          (scanError)="onScanError($event)"
        ></zxing-scanner>

        <div *ngIf="mostrarScanner && !scannerRunning && hasPermission" class="scanner-loading">
          <p>Iniciando scanner...</p>
        </div>
      </div>

      <label>Forma de Pagamento:</label>
      <select formControlName="formaPagamento">
        <option value="">Selecione</option>
        <option value="Pix">Pix</option>
        <option value="Cartão">Cartão</option>
        <option value="Dinheiro">Dinheiro</option>
      </select>

      <h3>Total: R$ {{ calcularTotal() | number: '1.2-2' }}</h3>

      <button type="submit" [disabled]="vendaForm.invalid">Finalizar Venda</button>
    </form>
  </main>
</div>
</body>